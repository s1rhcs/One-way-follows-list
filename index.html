<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fallen Follow Registry</title>
  <style>
    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
    }

    :root {
      --radius-lg: 22px;
      --radius-pill: 999px;
      --transition-fast: 0.14s ease;
    }

    /* DARK THEME TOKENS (default) */
    body.theme-dark {
      --ds-bg: #020308;
      --ds-bg-alt: #020308;
      --ds-panel-bg-main: #060713;
      --ds-panel-bg-alt: #020309;
      --ds-panel-border: #111827;
      --ds-holo-blue: #1fb0ff;
      --ds-holo-blue-soft: #7dd3fc;
      --ds-holo-orange: #ffb347;
      --ds-danger: #ef4444;
      --ds-text-main: #e5f0ff;
      --ds-text-soft: #9ca3c7;
      --ds-grid-line: rgba(148, 163, 184, 0.08);
      --ds-row-even: #050614;
      --ds-row-odd: #02030c;
      --ds-row-hover: #091023;
    }

    /* LIGHTER HUD THEME TOKENS */
    body.theme-light {
      --ds-bg: #050912;
      --ds-bg-alt: #050912;
      --ds-panel-bg-main: #0a111f;
      --ds-panel-bg-alt: #050912;
      --ds-panel-border: #1f2937;
      --ds-holo-blue: #38bdf8;
      --ds-holo-blue-soft: #bae6fd;
      --ds-holo-orange: #fdba74;
      --ds-danger: #f97373;
      --ds-text-main: #e5f0ff;
      --ds-text-soft: #a5b4cf;
      --ds-grid-line: rgba(148, 163, 184, 0.14);
      --ds-row-even: #07111f;
      --ds-row-odd: #050a17;
      --ds-row-hover: #0b1627;
    }

    /* GLOBAL BACKGROUND */
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: var(--ds-text-main);
      background:
        radial-gradient(circle at top, #0b1020 0, var(--ds-bg) 45%, #000000 100%),
        linear-gradient(160deg, var(--ds-bg-alt) 0, var(--ds-bg-alt) 40%, var(--ds-bg-alt) 100%);
      position: relative;
      overflow-x: hidden;
      transition: background 0.25s ease, color 0.25s ease;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image:
        linear-gradient(var(--ds-grid-line) 1px, transparent 1px),
        linear-gradient(90deg, var(--ds-grid-line) 1px, transparent 1px);
      background-size: 80px 80px;
      opacity: 0.6;
      mix-blend-mode: soft-light;
      z-index: 0;
    }

    body::after {
      content: "";
      position: fixed;
      left: -10%;
      right: -10%;
      bottom: -10%;
      height: 40%;
      background:
        radial-gradient(circle at 50% -40%, transparent 0, transparent 40%, rgba(0, 0, 0, 0.93) 80%);
      z-index: 0;
      pointer-events: none;
    }

    .landing {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 20px;
      position: relative;
      z-index: 1;
    }

    .landing-panel {
      max-width: 720px;
      width: 100%;
      padding: 28px 28px 22px;
      border-radius: 26px;
      background:
        radial-gradient(circle at top left, rgba(17, 24, 39, 0.98) 0, rgba(8, 13, 24, 0.98) 60%),
        linear-gradient(145deg, rgba(6, 10, 22, 0.98), rgba(3, 6, 15, 0.98));
      border: 1px solid rgba(31, 41, 55, 0.95);
      box-shadow:
        0 24px 40px rgba(0, 0, 0, 1),
        0 0 40px rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      position: relative;
      overflow: hidden;
    }

    .landing-panel::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: 24px;
      border: 1px solid rgba(31, 41, 55, 0.7);
      box-shadow:
        0 0 24px rgba(31, 41, 55, 0.9),
        0 0 60px rgba(15, 23, 42, 0.8);
      opacity: 0.6;
      pointer-events: none;
    }

    .landing-title-wrap,
    .step-list,
    .upload-box,
    .tutorial-card,
    .landing-footer {
      line-height: 1.6;
    }

    .landing-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      margin-bottom: 16px;
    }

    .landing-title-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .landing-title {
      font-size: 22px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      margin: 0;
      color: var(--ds-holo-blue-soft);
      text-shadow:
        0 0 4px rgba(31, 146, 218, 0.6),
        0 0 12px rgba(31, 146, 218, 0.8);
    }

    .landing-sub {
      font-size: 15px;
      color: var(--ds-text-soft);
      margin: 0;
    }

    .landing-chip {
      font-size: 11px;
      padding: 6px 14px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(41, 182, 246, 0.6);
      background:
        linear-gradient(135deg, rgba(11, 18, 33, 0.98), rgba(6, 12, 26, 0.98));
      color: var(--ds-holo-blue-soft);
      white-space: nowrap;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      box-shadow:
        0 0 8px rgba(41, 182, 246, 0.7),
        0 0 22px rgba(15, 23, 42, 0.9);
    }

    .step-list {
      margin: 10px 0 18px;
      padding-left: 22px;
      font-size: 14px;
      color: var(--ds-text-soft);
    }

    .step-list li { margin-bottom: 6px; }

    .upload-box {
      margin-top: 6px;
      padding: 16px 16px 14px;
      border-radius: 20px;
      background: linear-gradient(135deg, #050815, #020309);
      border: 1px solid #1f2933;
      box-shadow:
        0 12px 30px rgba(0, 0, 0, 0.95),
        inset 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .upload-label-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .upload-title {
      font-size: 15px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .upload-hint {
      font-size: 12px;
      color: var(--ds-text-soft);
    }

    #file-input {
      display: block;
      margin: 0 auto 8px;
      color: transparent;
      max-width: 100%;
    }

    #file-input::file-selector-button {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(41, 182, 246, 0.85);
      background:
        linear-gradient(135deg, #051923, #021019),
        radial-gradient(circle at top, rgba(125, 211, 252, 0.4) 0, transparent 60%);
      color: var(--ds-holo-blue-soft);
      font-size: 13px;
      font-weight: 700;
      padding: 9px 24px;
      cursor: pointer;
      margin-right: 10px;
      box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.9),
        0 6px 16px rgba(0, 0, 0, 0.9),
        0 0 14px rgba(41, 182, 246, 0.7),
        0 0 26px rgba(41, 182, 246, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.16em;
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        filter var(--transition-fast),
        border-color var(--transition-fast);
    }

    #file-input::file-selector-button:hover {
      transform: translateY(-1px) scale(1.01);
      box-shadow:
        0 3px 6px rgba(0, 0, 0, 1),
        0 10px 26px rgba(0, 0, 0, 1),
        0 0 20px rgba(125, 211, 252, 0.95),
        0 0 40px rgba(41, 182, 246, 0.7);
      filter: brightness(1.07);
      border-color: var(--ds-holo-blue-soft);
    }

    #file-input::file-selector-button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow:
        0 2px 4px rgba(0, 0, 0, 1),
        0 6px 18px rgba(0, 0, 0, 0.95),
        0 0 14px rgba(41, 182, 246, 0.8);
      filter: brightness(0.97);
    }

    .file-pills {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 10px;
    }

    .file-pill {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 7px 12px;
      border-radius: var(--radius-pill);
      background: rgba(7, 12, 24, 0.96);
      font-size: 13px;
      box-shadow:
        inset 0 0 0 1px #111827,
        0 3px 10px rgba(0, 0, 0, 0.85);
    }

    .file-pill-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .file-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #4b5563;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
    }

    .file-label {
      color: var(--ds-text-main);
      font-weight: 500;
    }

    .file-name {
      color: var(--ds-text-soft);
      font-size: 12px;
    }

    .file-pill.ready .file-dot {
      background: var(--ds-holo-blue);
      box-shadow: 0 0 10px rgba(41, 182, 246, 0.95);
    }

    .file-pill.ready .file-name {
      color: var(--ds-holo-blue-soft);
      font-weight: 500;
    }

    .file-pill.error .file-dot {
      background: var(--ds-danger);
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.95);
    }

    .file-pill.error .file-name {
      color: #fecaca;
      font-weight: 500;
    }

    .file-status-text {
      font-size: 12px;
      color: var(--ds-text-soft);
      margin-top: 7px;
      min-height: 16px;
    }

    .file-status-text.ok { color: var(--ds-holo-blue-soft); }
    .file-status-text.err { color: #fecaca; }

    .actions-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 12px;
    }

    .build-btn {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 179, 71, 0.8);
      background:
        linear-gradient(135deg, #2b1505, #3f2410),
        radial-gradient(circle at top, rgba(255, 179, 71, 0.45) 0, transparent 60%);
      color: #fff7ed;
      font-size: 13px;
      padding: 9px 24px;
      cursor: pointer;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      box-shadow:
        0 2px 4px rgba(0, 0, 0, 1),
        0 8px 20px rgba(0, 0, 0, 1),
        0 0 18px rgba(255, 179, 71, 0.9),
        0 0 36px rgba(248, 181, 87, 0.7);
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        opacity var(--transition-fast),
        filter var(--transition-fast),
        border-color var(--transition-fast);
    }

    .build-btn:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
      filter: grayscale(0.35);
    }

    .build-btn:not(:disabled):hover {
      transform: translateY(-1px) scale(1.01);
      box-shadow:
        0 3px 8px rgba(0, 0, 0, 1),
        0 12px 26px rgba(0, 0, 0, 1),
        0 0 26px rgba(255, 179, 71, 1),
        0 0 48px rgba(248, 181, 87, 0.85);
      filter: brightness(1.05);
      border-color: #fed7aa;
    }

    .build-btn:not(:disabled):active {
      transform: translateY(1px) scale(0.99);
      box-shadow:
        0 2px 6px rgba(0, 0, 0, 1),
        0 8px 20px rgba(0, 0, 0, 0.95),
        0 0 18px rgba(253, 186, 116, 0.9);
      filter: brightness(0.98);
    }

    .upload-status {
      font-size: 12px;
      text-align: right;
      color: var(--ds-holo-blue-soft);
    }

    .upload-status.loading { color: var(--ds-holo-orange); }
    .upload-status.done { color: var(--ds-holo-blue); }
    .upload-status.error { color: var(--ds-danger); }

    .tutorial-card {
      margin-top: 14px;
      padding: 10px 13px;
      border-radius: 18px;
      background: #050814;
      border: 1px solid #1f2933;
      font-size: 12px;
      color: var(--ds-text-main);
      line-height: 1.6;
      box-shadow:
        0 10px 24px rgba(0, 0, 0, 0.95),
        inset 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .tutorial-card details { cursor: pointer; }

    .tutorial-card summary {
      list-style: none;
      font-weight: 600;
      color: var(--ds-holo-blue-soft);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tutorial-card summary::before {
      content: "‚ñ∏";
      font-size: 11px;
      transition: transform 0.15s ease;
      color: var(--ds-holo-orange);
    }

    .tutorial-card details[open] summary::before {
      transform: rotate(90deg);
    }

    .tutorial-card summary::-webkit-details-marker { display: none; }
    .tutorial-card details[open] summary { margin-bottom: 6px; }

    .tutorial-card ol {
      margin: 0;
      padding-left: 20px;
    }

    .landing-footer {
      margin-top: 14px;
      font-size: 12px;
      color: var(--ds-text-soft);
      line-height: 1.6;
    }

    .landing-footer strong {
      color: var(--ds-holo-blue-soft);
    }

    .page {
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
      padding: 24px 16px 32px;
      flex: 1;
      position: relative;
      z-index: 1;
    }

    .hidden { display: none !important; }

    .header-card,
    .table-card {
      background: linear-gradient(145deg, var(--ds-panel-bg-main), var(--ds-panel-bg-alt));
      border-radius: 24px;
      border: 1px solid var(--ds-panel-border);
      box-shadow:
        0 20px 60px rgba(0, 0, 0, 1),
        0 0 32px rgba(15, 23, 42, 0.8);
      position: relative;
      overflow: hidden;
    }

    .header-card {
      padding: 20px 22px 18px;
      text-align: center;
      margin-bottom: 18px;
      line-height: 1.6;
    }

    .header-card:first-child { margin-top: 0; }
    .table-card:last-child { margin-bottom: 0; }

    .title-row {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 6px 16px;
      border-radius: 999px;
      background: #050815;
      border: 1px solid rgba(41, 182, 246, 0.7);
      box-shadow:
        0 2px 4px rgba(0, 0, 0, 1),
        0 8px 18px rgba(0, 0, 0, 1),
        0 0 16px rgba(41, 182, 246, 0.8);
    }

    .title-emoji { font-size: 22px; }

    h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--ds-holo-blue-soft);
      text-shadow:
        0 0 4px rgba(41, 182, 246, 0.5),
        0 0 10px rgba(41, 182, 246, 0.7);
    }

    .theme-toggle {
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--ds-text-soft);
    }

    .theme-toggle button {
      border-radius: var(--radius-pill);
      border: 1px solid #1f2933;
      background: #050815;
      color: var(--ds-text-soft);
      font-size: 11px;
      padding: 4px 10px;
      cursor: pointer;
      transition:
        background var(--transition-fast),
        border-color var(--transition-fast),
        transform 0.1s ease,
        box-shadow var(--transition-fast),
        color var(--transition-fast);
    }

    .theme-toggle button:hover {
      transform: translateY(-0.5px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.9);
    }

    .subtitle {
      margin: 6px 0 0;
      font-size: 13px;
      color: var(--ds-text-soft);
      line-height: 1.6;
    }

    #joke-line {
      margin-top: 4px;
      font-size: 12px;
      color: var(--ds-holo-orange);
      opacity: 0.9;
    }

    .controls {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    .search-box input {
      background: #050815;
      border-radius: var(--radius-pill);
      border: 1px solid #1f2933;
      padding: 6px 12px;
      color: var(--ds-text-main);
      font-size: 13px;
      min-width: 220px;
      outline: none;
      transition:
        border-color var(--transition-fast),
        box-shadow var(--transition-fast),
        transform 0.1s ease;
    }

    .search-box input::placeholder { color: #6b7280; }

    .search-box input:focus {
      border-color: var(--ds-holo-blue);
      box-shadow: 0 0 0 1px rgba(41, 182, 246, 0.7);
      transform: translateY(-1px);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }

    .filter-chip {
      border-radius: var(--radius-pill);
      border: 1px solid #1f2933;
      padding: 5px 10px;
      font-size: 11px;
      background: #050815;
      color: var(--ds-text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition:
        background var(--transition-fast),
        border-color var(--transition-fast),
        transform 0.1s ease,
        box-shadow var(--transition-fast),
        color var(--transition-fast);
    }

    .filter-chip span.count {
      background: #020617;
      border-radius: 999px;
      padding: 1px 6px;
      font-size: 10px;
    }

    .filter-chip.active {
      border-color: var(--ds-holo-blue);
      color: var(--ds-holo-blue-soft);
      background: #06131f;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.95);
    }

    .filter-chip:hover {
      transform: translateY(-0.5px);
    }

    .progress-bar-wrap {
      margin-top: 10px;
      width: 100%;
      max-width: 380px;
      height: 6px;
      border-radius: 999px;
      border: 1px solid #111827;
      margin-left: auto;
      margin-right: auto;
      overflow: hidden;
      background: #020617;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--ds-holo-orange), var(--ds-holo-blue));
      box-shadow: 0 0 12px rgba(41, 182, 246, 0.8);
      transition: width 0.25s ease-out;
    }

    #progress-text {
      margin-top: 4px;
      font-size: 11px;
      color: var(--ds-text-soft);
    }

    .table-card { margin-top: 8px; }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 0;
    }

    thead {
      background: #050815;
    }

    th, td {
      padding: 9px 12px;
      font-size: 12px;
      text-align: left;
      white-space: nowrap;
      line-height: 1.6;
    }

    th {
      font-weight: 600;
      color: var(--ds-text-main);
      border-bottom: 1px solid #111827;
      cursor: pointer;
    }

    th.sortable::after {
      content: "‚áÖ";
      font-size: 10px;
      margin-left: 4px;
      opacity: 0.6;
    }

    th.sortable.asc::after { content: "‚Üë"; }
    th.sortable.desc::after { content: "‚Üì"; }

    tbody tr:nth-child(even) { background: var(--ds-row-even); }
    tbody tr:nth-child(odd)  { background: var(--ds-row-odd); }

    tbody tr:hover {
      background: var(--ds-row-hover);
    }

    tr.tag-unfollowed { background: rgba(127, 29, 29, 0.95) !important; }
    tr.tag-influencer { background: rgba(20, 83, 45, 0.95) !important; }
    tr.tag-public    { background: rgba(30, 64, 175, 0.95) !important; }

    td.user-cell { font-weight: 500; }
    td.date-cell { color: #9ca3af; font-size: 12px; }
    td.link-cell { width: 1%; }
    td.status-cell { width: 1%; }

    a {
      color: var(--ds-holo-blue-soft);
      text-decoration: none;
      font-weight: 500;
      transition: color var(--transition-fast), text-shadow var(--transition-fast);
    }

    a:hover {
      text-decoration: underline;
      text-shadow: 0 0 8px rgba(41, 182, 246, 0.7);
    }

    .tag-btn,
    .copy-btn {
      border-radius: var(--radius-pill);
      border: 1px solid #1f2933;
      background: #050815;
      color: var(--ds-text-soft);
      font-size: 11px;
      padding: 3px 8px;
      cursor: pointer;
      margin-right: 4px;
      transition:
        background var(--transition-fast),
        border-color var(--transition-fast),
        transform 0.1s ease,
        box-shadow var(--transition-fast),
        color var(--transition-fast);
    }

    .tag-btn:hover,
    .copy-btn:hover {
      transform: translateY(-0.5px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.9);
    }

    .tag-btn.active[data-tag="unfollowed"] {
      background: #7f1d1d;
      color: #fee2e2;
      border-color: #fecaca;
    }
    .tag-btn.active[data-tag="influencer"] {
      background: #166534;
      color: #dcfce7;
      border-color: #bbf7d0;
    }
    .tag-btn.active[data-tag="public"] {
      background: #1d4ed8;
      color: #dbeafe;
      border-color: #bfdbfe;
    }

    .copy-btn.copied {
      background: #022c22;
      color: #6ee7b7;
      border-color: #22c55e;
    }

    @media (max-width: 700px) {
      .landing-header-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .landing-chip {
        align-self: flex-start;
      }
      h1,
      .landing-title { font-size: 18px; }
      th, td {
        font-size: 11px;
        padding: 7px 8px;
      }
    }
  </style>
</head>
<body class="theme-dark">
  <!-- Landing / upload screen -->
  <div class="landing" id="landing">
    <div class="landing-panel">
      <div class="landing-header-row">
        <div class="landing-title-wrap">
          <h1 class="landing-title">FALLEN FOLLOW REGISTRY</h1>
          <p class="landing-sub">Logging every follow that didn‚Äôt follow through.</p>
        </div>
        <div class="landing-chip">Secure ‚Ä¢ No servers, No sign up, No bs, All private</div>
      </div>

      <ol class="step-list">
        <li>Export your Instagram data ZIP.</li>
        <li>Grab <strong>followers_1.json</strong> and <strong>following.json</strong>.</li>
        <li>Use the button below to select both files.</li>
      </ol>

      <div class="upload-box">
        <div class="upload-label-row">
          <span class="upload-title">Upload your JSON files</span>
          <span class="upload-hint">Only followers_1.json and following.json are needed.</span>
        </div>

        <input type="file" id="file-input" multiple accept=".json">

        <div class="file-pills">
          <div class="file-pill" id="pill-followers">
            <div class="file-pill-left">
              <span class="file-dot"></span>
              <span class="file-label">followers_1.json</span>
            </div>
            <span class="file-name" id="name-followers">(waiting)</span>
          </div>
          <div class="file-pill" id="pill-following">
            <div class="file-pill-left">
              <span class="file-dot"></span>
              <span class="file-label">following.json</span>
            </div>
            <span class="file-name" id="name-following">(waiting)</span>
          </div>
        </div>

        <div id="file-status-text" class="file-status-text">
          Choose both files to get started.
        </div>

        <div class="actions-row">
          <button id="build-btn" class="build-btn" disabled>Build Fallen Follows list</button>
          <div class="upload-status" id="upload-status"></div>
        </div>
      </div>

      <div class="tutorial-card">
        <details>
          <summary>How do I get these Instagram files?</summary>
          <ol>
            <li>Open Instagram and go to <strong>Settings ‚Üí Accounts Center</strong>.</li>
            <li>Tap <strong>Your information and permissions ‚Üí Export your information</strong>.</li>
            <li>Select your Instagram account and choose <strong>Some of your information</strong>.</li>
            <li>Only check <strong>Followers and following</strong>, set format to <strong>JSON</strong>, and choose <strong>Download to device</strong>.</li>
            <li>Create the file, then use the email or notification from Instagram to download the ZIP to your computer.</li>
            <li>Unzip it, then open <code>connections/followers_and_following</code>.</li>
            <li>Pick <strong>followers_1.json</strong> and <strong>following.json</strong> from that folder and upload them here.</li>
          </ol>
        </details>
      </div>

      <div class="landing-footer">
        Export from Instagram via <strong>Settings ‚Üí Accounts Center ‚Üí Export your information</strong>, then grab these two files from the ZIP.
      </div>
    </div>
  </div>

  <!-- Main dashboard -->
  <div class="page hidden" id="main-app">
    <div class="header-card" id="header-card">
      <div class="title-row">
        <span class="title-emoji">‚ö†Ô∏è</span>
        <h1>FALLEN FOLLOW REGISTRY</h1>
        <span class="title-emoji">‚ö†Ô∏è</span>
      </div>
      <div class="theme-toggle">
        <span>Theme:</span>
        <button id="theme-toggle-btn">Dark</button>
      </div>
      <p class="subtitle">
        Logging every follow that didn‚Äôt follow through.
      </p>
      <p class="subtitle">
        People you follow who don‚Äôt follow you back: <span id="count-total">0</span>
      </p>
      <p class="subtitle" id="joke-line"></p>

      <div class="controls">
        <div class="search-box">
          <input type="text" id="search-input" placeholder="Search username..." />
        </div>
        <div class="filters">
          <button class="filter-chip" data-filter="all">
            Show all <span class="count" id="count-all">0</span>
          </button>
          <button class="filter-chip" data-filter="unfollowed">
            Unfollowed ‚ùå <span class="count" id="count-unfollowed">0</span>
          </button>
          <button class="filter-chip" data-filter="influencer">
            Influencer üé• <span class="count" id="count-influencer">0</span>
          </button>
          <button class="filter-chip" data-filter="public">
            Public page üì≤ <span class="count" id="count-public">0</span>
          </button>
        </div>
      </div>

      <div class="progress-bar-wrap">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <p class="subtitle" id="progress-text"></p>
    </div>

    <div class="table-card" id="table-card">
      <table id="fake-list-table">
        <thead>
          <tr>
            <th class="sortable" data-sort-key="username">Username</th>
            <th class="sortable" data-sort-key="timestamp">Followed at</th>
            <th>Profile</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <!-- rows injected by JS -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const jokes = [
      "Signal lost. Links remain.",
      "Manual pruning recommended.",
      "Connections degraded. Consider severing.",
      "They‚Äôre not in your squad anymore."
    ];

    const fileInput = document.getElementById("file-input");
    const buildBtn = document.getElementById("build-btn");
    const uploadStatus = document.getElementById("upload-status");
    const pillFollowers = document.getElementById("pill-followers");
    const pillFollowing = document.getElementById("pill-following");
    const nameFollowers = document.getElementById("name-followers");
    const nameFollowing = document.getElementById("name-following");
    const fileStatusText = document.getElementById("file-status-text");
    const landing = document.getElementById("landing");
    const mainApp = document.getElementById("main-app");
    const themeToggleBtn = document.getElementById("theme-toggle-btn");

    let followersJson = null;
    let followingJson = null;

    function applyTheme(theme) {
      const body = document.body;
      if (theme === "light") {
        body.classList.remove("theme-dark");
        body.classList.add("theme-light");
        themeToggleBtn.textContent = "Light";
      } else {
        body.classList.remove("theme-light");
        body.classList.add("theme-dark");
        themeToggleBtn.textContent = "Dark";
      }
      localStorage.setItem("fallenfollow_theme", theme);
    }

    (function initTheme() {
      const stored = localStorage.getItem("fallenfollow_theme");
      if (stored === "light" || stored === "dark") {
        applyTheme(stored);
      } else {
        applyTheme("dark");
      }
    })();

    themeToggleBtn.addEventListener("click", () => {
      const current = document.body.classList.contains("theme-light") ? "light" : "dark";
      const next = current === "dark" ? "light" : "dark";
      applyTheme(next);
    });

    function setWaitingText(el) {
      el.textContent = "(waiting)";
    }

    function setUploadedText(el) {
      el.textContent = "Uploaded";
    }

    function setFilePillStateUploaded(pill, nameEl) {
      pill.classList.remove("error");
      pill.classList.add("ready");
      setUploadedText(nameEl);
    }

    function setFilePillStateError(pill, nameEl) {
      pill.classList.remove("ready");
      pill.classList.add("error");
      nameEl.textContent = "Error";
    }

    function updateBuildButtonState() {
      const ready = !!(followersJson && followingJson);
      buildBtn.disabled = !ready;
      fileStatusText.classList.remove("ok", "err");
      if (ready) {
        fileStatusText.textContent = "Nice. Both files are uploaded. You can build the registry now.";
        fileStatusText.classList.add("ok");
      } else {
        fileStatusText.textContent = "Choose both followers_1.json and following.json.";
      }
    }

    function readJsonFile(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (evt) => {
          try {
            const obj = JSON.parse(evt.target.result);
            resolve(obj);
          } catch (e) {
            reject(e);
          }
        };
        reader.onerror = () => reject(new Error("Failed to read file"));
        reader.readAsText(file);
      });
    }

    async function handleFiles(files) {
      if (!files || !files.length) return;

      uploadStatus.textContent = "";
      uploadStatus.className = "upload-status";

      let newFollowersFile = null;
      let newFollowingFile = null;

      for (const f of files) {
        const lower = f.name.toLowerCase();
        if (lower === "followers_1.json") newFollowersFile = f;
        if (lower === "following.json")   newFollowingFile = f;
      }

      if (newFollowersFile) {
        followersJson = null;
        pillFollowers.classList.remove("ready", "error");
        nameFollowers.textContent = "Reading‚Ä¶";

        uploadStatus.textContent = "Reading followers_1.json‚Ä¶";
        uploadStatus.classList.add("loading");

        try {
          const data = await readJsonFile(newFollowersFile);
          followersJson = data;
          setFilePillStateUploaded(pillFollowers, nameFollowers);
        } catch (e) {
          followersJson = null;
          setFilePillStateError(pillFollowers, nameFollowers);
          uploadStatus.textContent = "Could not read followers_1.json.";
          uploadStatus.classList.remove("loading");
          uploadStatus.classList.add("error");
        }
      }

      if (newFollowingFile) {
        followingJson = null;
        pillFollowing.classList.remove("ready", "error");
        nameFollowing.textContent = "Reading‚Ä¶";

        if (!newFollowersFile) {
          uploadStatus.textContent = "Reading following.json‚Ä¶";
          uploadStatus.classList.add("loading");
        }

        try {
          const data = await readJsonFile(newFollowingFile);
          followingJson = data;
          setFilePillStateUploaded(pillFollowing, nameFollowing);
        } catch (e) {
          followingJson = null;
          setFilePillStateError(pillFollowing, nameFollowing);
          uploadStatus.textContent = "Could not read following.json.";
          uploadStatus.classList.remove("loading");
          uploadStatus.classList.add("error");
        }
      }

      updateBuildButtonState();

      if (followersJson && followingJson) {
        uploadStatus.textContent = "Both files uploaded.";
        uploadStatus.classList.remove("loading");
        uploadStatus.classList.add("done");
      } else if (!uploadStatus.classList.contains("error")) {
        uploadStatus.textContent = "Waiting for the other file.";
      }
    }

    fileInput.addEventListener("change", (e) => {
      handleFiles(e.target.files);
    });

    function isProbablyDeleted(title, href) {
      if (!title || !href) return true;
      const lower = String(title).toLowerCase();
      if (lower === "instagram user") return true;
      if (lower.startsWith("__deleted__")) return true;
      if (!href.includes("instagram.com")) return true;
      return false;
    }

    function buildNotFollowingBack(followersData, followingData) {
      const followers = new Set();
      if (Array.isArray(followersData)) {
        for (const entry of followersData) {
          const data = entry && entry.string_list_data;
          if (Array.isArray(data) && data[0] && data[0].value) {
            followers.add(data[0].value);
          }
        }
      }

      const followingEntries = [];
      const list = followingData && followingData.relationships_following;
      if (Array.isArray(list)) {
        for (const entry of list) {
          const title = entry.title;
          const sdata = entry.string_list_data;
          if (!title || !Array.isArray(sdata) || !sdata[0]) continue;
          const href = sdata[0].href;
          const ts = sdata[0].timestamp;

          if (isProbablyDeleted(title, href)) continue;

          followingEntries.push({ username: title, href, timestamp: ts });
        }
      }

      return followingEntries
        .filter(e => !followers.has(e.username))
        .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
    }

    function renderTable(notFollowingList) {
      const tbody = document.querySelector("#fake-list-table tbody");
      tbody.innerHTML = "";

      for (const e of notFollowingList) {
        const username = e.username;
        const href = e.href || ("https://www.instagram.com/" + username);
        const ts = e.timestamp;
        let dateStr = "unknown";
        if (typeof ts === "number") {
          const d = new Date(ts * 1000);
          const opts = { year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit" };
          dateStr = d.toLocaleString(undefined, opts);
        }
        const tr = document.createElement("tr");
        tr.setAttribute("data-username", username);
        tr.setAttribute("data-timestamp", ts || "");

        tr.innerHTML = `
          <td class="user-cell" title="Mark them however they deserve">${username}</td>
          <td class="date-cell">${dateStr}</td>
          <td class="link-cell">
            <a href="${href}" target="_blank">Open</a>
            <button class="copy-btn" data-href="${href}" title="Copy link">Copy</button>
          </td>
          <td class="status-cell">
            <button class="tag-btn" data-tag="unfollowed">Unfollowed</button>
            <button class="tag-btn" data-tag="influencer">Influencer/Celeb</button>
            <button class="tag-btn" data-tag="public">Public page</button>
          </td>
        `;
        tbody.appendChild(tr);
      }

      document.getElementById("count-total").textContent = notFollowingList.length;
      document.getElementById("count-all").textContent = notFollowingList.length;

      const jokeEl = document.getElementById("joke-line");
      if (jokeEl && jokes.length) {
        jokeEl.textContent = jokes[Math.floor(Math.random() * jokes.length)];
      }
    }

    function setupTagging() {
      const tableBody = document.querySelector("#fake-list-table tbody");
      const progressBar = document.getElementById("progress-bar");
      const progressText = document.getElementById("progress-text");

      const counts = {
        all: 0,
        unfollowed: 0,
        influencer: 0,
        public: 0,
        processed: 0
      };

      function recalcCounts() {
        const rows = Array.from(document.querySelectorAll("#fake-list-table tbody tr"));
        counts.all = rows.length;
        counts.unfollowed = 0;
        counts.influencer = 0;
        counts.public = 0;
        counts.processed = 0;

        rows.forEach(row => {
          let tag = null;
          if (row.classList.contains("tag-unfollowed")) tag = "unfollowed";
          if (row.classList.contains("tag-influencer")) tag = "influencer";
          if (row.classList.contains("tag-public")) tag = "public";
          if (tag) {
            counts[tag] += 1;
            counts.processed += 1;
          }
        });

        document.getElementById("count-all").textContent = counts.all;
        document.getElementById("count-unfollowed").textContent = counts.unfollowed;
        document.getElementById("count-influencer").textContent = counts.influencer;
        document.getElementById("count-public").textContent = counts.public;

        const pct = counts.all ? Math.round((counts.processed / counts.all) * 100) : 0;
        progressBar.style.width = pct + "%";
        progressText.textContent = "Processed: " + counts.processed + " / " + counts.all + " (" + pct + "%)";
      }

      function applyRowTag(row, tag) {
        row.classList.remove("tag-unfollowed", "tag-influencer", "tag-public");
        row.querySelectorAll(".tag-btn").forEach(btn => btn.classList.remove("active"));
        if (!tag) return;
        row.classList.add("tag-" + tag);
        const btn = row.querySelector(".tag-btn[data-tag='" + tag + "']");
        if (btn) btn.classList.add("active");
      }

      function copyToClipboard(text, btn) {
        if (!navigator.clipboard) {
          const ta = document.createElement("textarea");
          ta.value = text;
          ta.style.position = "fixed";
          ta.style.opacity = "0";
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          try { document.execCommand("copy"); } catch (e) {}
          document.body.removeChild(ta);
        } else {
          navigator.clipboard.writeText(text).catch(() => {});
        }
        btn.classList.add("copied");
        setTimeout(() => btn.classList.remove("copied"), 800);
      }

      tableBody.addEventListener("click", (evt) => {
        const btn = evt.target.closest(".tag-btn");
        const copyBtn = evt.target.closest(".copy-btn");

        if (copyBtn) {
          const href = copyBtn.getAttribute("data-href");
          if (href) copyToClipboard(href, copyBtn);
          return;
        }

        if (!btn) return;

        const row = btn.closest("tr");
        const tag = btn.getAttribute("data-tag");

        let currentTag = null;
        if (row.classList.contains("tag-unfollowed")) currentTag = "unfollowed";
        if (row.classList.contains("tag-influencer")) currentTag = "influencer";
        if (row.classList.contains("tag-public")) currentTag = "public";

        const newTag = (currentTag === tag) ? null : tag;

        applyRowTag(row, newTag);
        recalcCounts();
      });

      recalcCounts();
    }

    function setupFiltersAndSorting() {
      const searchInput = document.getElementById("search-input");
      const rowsSelector = "#fake-list-table tbody tr";
      let activeFilter = "all";
      let searchTerm = "";
      let currentSort = { key: "timestamp", dir: "desc" };

      function rowMatchesFilterAndSearch(row, filter, searchTerm) {
        const username = (row.getAttribute("data-username") || "").toLowerCase();
        let tag = null;
        if (row.classList.contains("tag-unfollowed")) tag = "unfollowed";
        if (row.classList.contains("tag-influencer")) tag = "influencer";
        if (row.classList.contains("tag-public")) tag = "public";

        const matchesFilter = (filter === "all") ? true : tag === filter;
        const matchesSearch = username.includes(searchTerm.toLowerCase());
        return matchesFilter && matchesSearch;
      }

      function applyFilterAndSearch() {
        const rows = document.querySelectorAll(rowsSelector);
        rows.forEach(row => {
          const show = rowMatchesFilterAndSearch(row, activeFilter, searchTerm);
          row.style.display = show ? "" : "none";
        });
        document.querySelectorAll(".filter-chip").forEach(chip => {
          chip.classList.toggle("active", chip.getAttribute("data-filter") === activeFilter);
        });
      }

      document.querySelector(".filters").addEventListener("click", evt => {
        const chip = evt.target.closest(".filter-chip");
        if (!chip) return;
        activeFilter = chip.getAttribute("data-filter") || "all";
        applyFilterAndSearch();
      });

      searchInput.addEventListener("input", () => {
        searchTerm = searchInput.value || "";
        applyFilterAndSearch();
      });

      function sortTableBy(key, direction) {
        const tbody = document.querySelector("#fake-list-table tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));

        rows.sort((a, b) => {
          if (key === "username") {
            const ua = (a.getAttribute("data-username") || "").toLowerCase();
            const ub = (b.getAttribute("data-username") || "").toLowerCase();
            if (ua < ub) return direction === "asc" ? -1 : 1;
            if (ua > ub) return direction === "asc" ? 1 : -1;
            return 0;
          }
          if (key === "timestamp") {
            const ta = parseInt(a.getAttribute("data-timestamp") || "0", 10);
            const tb = parseInt(b.getAttribute("data-timestamp") || "0", 10);
            return direction === "asc" ? (ta - tb) : (tb - ta);
          }
          return 0;
        });

        rows.forEach(r => tbody.appendChild(r));
      }

      document.querySelectorAll("th.sortable").forEach(th => {
        th.addEventListener("click", () => {
          const key = th.getAttribute("data-sort-key");
          if (!key) return;

          if (currentSort.key === key) {
            currentSort.dir = currentSort.dir === "asc" ? "desc" : "asc";
          } else {
            currentSort.key = key;
            currentSort.dir = key === "timestamp" ? "desc" : "asc";
          }

          document.querySelectorAll("th.sortable").forEach(h => h.classList.remove("asc", "desc"));
          th.classList.add(currentSort.dir);

          sortTableBy(currentSort.key, currentSort.dir);
          applyFilterAndSearch();
        });
      });

      applyFilterAndSearch();
    }

    buildBtn.addEventListener("click", () => {
      if (!(followersJson && followingJson)) return;
      uploadStatus.textContent = "Building registry‚Ä¶";
      uploadStatus.classList.remove("error");
      uploadStatus.classList.add("loading");

      const list = buildNotFollowingBack(followersJson, followingJson);
      renderTable(list);
      setupTagging();
      setupFiltersAndSorting();
      uploadStatus.textContent = "";
      uploadStatus.classList.remove("loading");

      landing.classList.add("hidden");
      mainApp.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  </script>
</body>
</html>
